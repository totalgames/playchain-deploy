FROM baseroom:latest
MAINTAINER Total Games LLC and contributors

ARG PLAYCHAIN_SRC_DIR
ARG POKER_ROOM_SRC_DIR

ARG USER=room
ARG ROOM_HOME=/var/lib/room
ARG LIVE_TESTNET

ARG CONFIG_OFF_LOGO
ARG CONFIG_DEBUG
ARG CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_API_URL
ARG CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_P2P_URL
ARG CONFIG_PLAYCHAIN_DATABASE_API_INTERFACE=0.0.0.0
ARG CONFIG_PLAYCHAIN_DATABASE_API_PORT=8500
ARG CONFIG_PLAYCHAIN_DATABASE_TLS_API_INTERFACE=0.0.0.0
ARG CONFIG_PLAYCHAIN_DATABASE_TLS_API_PORT=8501
ARG CONFIG_PLAYCHAIN_DATABASE_P2P_INTERFACE=0.0.0.0
ARG CONFIG_PLAYCHAIN_DATABASE_P2P_PORT=10300
ARG CONFIG_POKER_ROOM_INTERFACE=0.0.0.0
ARG CONFIG_POKER_ROOM_PORT=8092
ARG CONFIG_POKER_ROOM_CONTROL_PORT=9100
ARG CONFIG_GENESIS

ENV USER=${USER}
ENV LIVE_TESTNET=${LIVE_TESTNET:-OFF}
ENV CONFIG_OFF_LOGO=${CONFIG_OFF_LOGO}
ENV CONFIG_DEBUG=${CONFIG_DEBUG}
ENV CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_API_URL=${CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_API_URL}
ENV CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_P2P_URL=${CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_P2P_URL}
ENV CONFIG_PLAYCHAIN_DATABASE_API_INTERFACE=${CONFIG_PLAYCHAIN_DATABASE_API_INTERFACE}
ENV CONFIG_PLAYCHAIN_DATABASE_API_PORT=${CONFIG_PLAYCHAIN_DATABASE_API_PORT}
ENV CONFIG_PLAYCHAIN_DATABASE_TLS_API_INTERFACE=${CONFIG_PLAYCHAIN_DATABASE_TLS_API_INTERFACE}
ENV CONFIG_PLAYCHAIN_DATABASE_TLS_API_PORT=${CONFIG_PLAYCHAIN_DATABASE_TLS_API_PORT}
ENV CONFIG_PLAYCHAIN_DATABASE_P2P_INTERFACE=${CONFIG_PLAYCHAIN_DATABASE_P2P_INTERFACE}
ENV CONFIG_PLAYCHAIN_DATABASE_P2P_PORT=${CONFIG_PLAYCHAIN_DATABASE_P2P_PORT}
ENV CONFIG_POKER_ROOM_INTERFACE=${CONFIG_POKER_ROOM_INTERFACE}
ENV CONFIG_POKER_ROOM_PORT=${CONFIG_POKER_ROOM_PORT}
ENV CONFIG_GENESIS=${CONFIG_GENESIS}

ENV LANG=en_US.UTF-8

VOLUME ["/var/lib/room", "/etc/room"]

EXPOSE ${CONFIG_PLAYCHAIN_DATABASE_API_PORT}
EXPOSE ${CONFIG_PLAYCHAIN_DATABASE_TLS_API_PORT}
EXPOSE ${CONFIG_PLAYCHAIN_DATABASE_P2P_PORT}
EXPOSE ${CONFIG_POKER_ROOM_PORT}
EXPOSE ${CONFIG_POKER_ROOM_CONTROL_PORT}    

ADD docker/roomentry.sh /usr/local/bin/roomentry.sh
ADD docker/roomentry.py /usr/local/bin/roomentry.py
RUN \
    chmod a+x /usr/local/bin/roomentry.sh && \
    chmod a+x /usr/local/bin/roomentry.py

# default execute entry
CMD ["/bin/bash", "/usr/local/bin/roomentry.sh"]

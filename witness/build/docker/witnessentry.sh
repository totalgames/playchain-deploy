#!/bin/bash

echo ">> * ROOMENTRY.SH"
echo '>> HOME = '$HOME
echo '>> USER = '$USER
echo '>> CONFIGURATE = '$CONFIGURATE
echo '>> CONFIG_OFF_LOGO = '$CONFIG_OFF_LOGO
echo '>> CONFIG_DEBUG = '$CONFIG_DEBUG
echo '>> CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_API_URL = '$CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_API_URL
echo '>> CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_P2P_URL = '$CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_P2P_URL
echo '>> CONFIG_PLAYCHAIN_DATABASE_API_PORT = '$CONFIG_PLAYCHAIN_DATABASE_API_PORT
echo '>> CONFIG_PLAYCHAIN_DATABASE_P2P_PORT = '$CONFIG_PLAYCHAIN_DATABASE_P2P_PORT
echo '>> CONFIG_GENESIS = '$CONFIG_GENESIS

ENV_EXPORT_DIR=${HOME}/.environment
mkdir -p ${ENV_EXPORT_DIR} || exit 1
cd ${ENV_EXPORT_DIR}
echo $CONFIG_OFF_LOGO > "CONFIG_OFF_LOGO"
echo $CONFIG_DEBUG > "CONFIG_DEBUG"
echo $CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_API_URL > "CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_API_URL"
echo $CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_P2P_URL > "CONFIG_EXTERNAL_PLAYCHAIN_DATABASE_P2P_URL"
echo $CONFIG_PLAYCHAIN_DATABASE_API_PORT > "CONFIG_PLAYCHAIN_DATABASE_API_PORT"
echo $CONFIG_PLAYCHAIN_DATABASE_P2P_PORT > "CONFIG_PLAYCHAIN_DATABASE_P2P_PORT"
echo $CONFIG_GENESIS > "CONFIG_GENESIS"

PYTHON_BIN=$(which python3)
ROOMENTRY_BIN="/usr/local/bin/roomentry.py"

ulimit -c unlimited

exec chpst -u ${USER} -e ${ENV_EXPORT_DIR} ${PYTHON_BIN} ${ROOMENTRY_BIN}
